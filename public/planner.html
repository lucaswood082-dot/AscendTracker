<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Planner</title>

<meta name="theme-color" content="#111827">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-capable" content="yes">

<link rel="stylesheet" href="style.css">

<style>
/* ===== TOP NAV ===== */
.top-nav { position: sticky; top: 0; z-index: 100; background: #111827; border-bottom: 1px solid #1f2937; padding: 1rem; font-weight: 600; color: #38bdf8; font-size: 1.2rem; text-align: center; }
/* ===== PAGE ===== */
.page { padding: 1rem; min-height: 100vh; padding-bottom: 140px; }
.container { max-width: 480px; margin: 0 auto; }
/* ===== CARD ===== */
.card { background: #111827; border-radius: 14px; padding: 1.25rem; margin-bottom: 1rem; border: 1px solid #1f2937; }
/* ===== INPUTS ===== */
input { width: 100%; padding: 0.75rem; border-radius: 10px; border: 1px solid #1f2937; background: #020617; color: #e5e7eb; font-size: 16px; margin-bottom: 0.75rem; }
/* ===== BUTTONS ===== */
button { width: 100%; padding: 0.75rem; border-radius: 10px; border: none; background: #38bdf8; color: #020617; font-weight: 600; cursor: pointer; margin-top: 0.5rem; }
button.secondary { background: #1f2937; color: #e5e7eb; }
/* ===== DATE PICKER ===== */
.date-wrapper { position: relative; margin-bottom: 0.75rem; }
.date-display { width: 100%; padding: 0.75rem; border-radius: 10px; border: 1px solid #1f2937; background: #020617; color: #e5e7eb; font-size: 16px; cursor: pointer; }
.date-hidden { position: absolute; inset: 0; opacity: 0; }
/* ===== DAY VIEW ===== */
.days-card { overflow: hidden; }
.day-box { border: 1px solid #1f2937; border-radius: 12px; padding: 0.9rem; background: #020617; position: relative; transition: transform 0.3s cubic-bezier(0.22,1,0.36,1); user-select: none; -webkit-user-select:none; -ms-user-select:none; -webkit-touch-callout:none; touch-action: manipulation; }
.day-title { font-weight: 600; margin-bottom: 0.4rem; color: #38bdf8; }
.day-workout { font-size: 0.95rem; color: #e5e7eb; }
.empty { color: #9ca3af; font-size: 0.9rem; }
/* ===== SWIPE CLASSES ===== */
.day-box.swipe-left { transform: translateX(-100%); }
.day-box.swipe-right { transform: translateX(100%); }
.day-box.swipe-reset { transform: translateX(0); }
</style>
</head>

<body class="planner-page">

<div class="top-nav">Ascend</div>

<div class="page">
  <div class="container">

    <!-- ADD WORKOUT -->
    <div class="card">
      <h3>Add Workout</h3>

      <input type="text" id="workoutName" placeholder="Workout Name" />

      <div class="date-wrapper">
        <input type="text" id="dateDisplay" class="date-display" placeholder="Select date" readonly />
        <input type="date" id="dateInput" class="date-hidden" />
      </div>

      <button id="addBtn">Add Workout</button>
      <button id="backBtn" class="secondary">Back</button>
    </div>

    <!-- DAY VIEW -->
    <div class="card days-card">
      <h3>Day</h3>
      <div id="dayView"></div>
    </div>

  </div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button onclick="location.href='dashboard.html'"><span class="icon"><img src="/icons/home.png" class="nav-icon"></span><span class="label">Home</span></button>
  <button onclick="location.href='view.html'"><span class="icon"><img src="/icons/workout.png" class="nav-icon"></span><span class="label">Workouts</span></button>
  <button class="create-btn" onclick="location.href='workout.html'"><span class="icon">ï¼‹</span></button>
  <button disabled><span class="icon"><img src="/icons/analytics.png" class="nav-icon"></span><span class="label">Analytics</span></button>
  <button disabled><span class="icon"><img src="/icons/profile.png" class="nav-icon"></span><span class="label">Profile</span></button>
</nav>

<script>
const planner = JSON.parse(localStorage.getItem('planner')) || {};
const dayView = document.getElementById('dayView');
const workoutName = document.getElementById('workoutName');
const dateInput = document.getElementById('dateInput');
const dateDisplay = document.getElementById('dateDisplay');
const addBtn = document.getElementById('addBtn');
const backBtn = document.getElementById('backBtn');

let offset = 0;
let lastTap = 0;

/* LOCAL DATE STRING (NO UTC) */
function getLocalDateKey(date) {
  const y = date.getFullYear();
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `${y}-${m}-${d}`;
}

/* DATE PICKER SYNC */
dateDisplay.addEventListener('click', () => dateInput.showPicker?.());
dateInput.addEventListener('change', () => dateDisplay.value = dateInput.value);

/* BACK BUTTON */
backBtn.addEventListener('click', () => location.href='dashboard.html');

/* ADD WORKOUT */
addBtn.onclick = () => {
  if (!workoutName.value || !dateInput.value) {
    alert('Enter name & date');
    return;
  }

  planner[dateInput.value] = workoutName.value;
  localStorage.setItem('planner', JSON.stringify(planner));

  workoutName.value = '';
  dateInput.value = '';
  dateDisplay.value = '';
  renderDay();
};

/* RENDER SINGLE DAY */
function renderDay() {
  const d = new Date();
  d.setDate(d.getDate() + offset);

  const key = getLocalDateKey(d);

  dayView.innerHTML = `
    <div class="day-box swipe-reset" data-date="${key}">
      <div class="day-title">${d.toDateString()}</div>
      <div class="day-workout">
        ${planner[key] || '<span class="empty">No workout</span>'}
      </div>
    </div>
  `;

  const box = dayView.querySelector('.day-box');

  // DOUBLE TAP TO DELETE
  box.addEventListener('touchend', e => {
    const now = Date.now();
    if (now - lastTap < 300) {
      e.preventDefault();
      if (planner[key]) {
        delete planner[key];
        localStorage.setItem('planner', JSON.stringify(planner));
        renderDay();
        navigator.vibrate?.(50);
      }
    }
    lastTap = now;
  });

  // SWIPE
  let startX = 0;
  box.addEventListener('touchstart', e => startX = e.touches[0].clientX);
  box.addEventListener('touchend', e => {
    const dx = e.changedTouches[0].clientX - startX;
    if (dx < -50) setTimeout(() => { offset++; renderDay(); }, 300);
    if (dx > 50) setTimeout(() => { offset--; renderDay(); }, 300);
  });
}

/* INITIAL */
renderDay();
</script>

</body>
</html>
